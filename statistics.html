<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PhCard - Statistiken</title>
    <link rel="stylesheet" href="public/css/style.css">
    <link rel="stylesheet" href="public/css/dashboard.css">
</head>
<body>
    <div id="app">
        <div class="statistics-container dashboard-container">
            <div class="statistics-header dashboard-header">
                <h1>Meine Statistiken</h1>
                <button class="back-btn" onclick="window.location.href='index.html'">Zurück zum Menü</button>
            </div>
            
            <h2 class="stats-section-title">Einzelspieler (vs KI)</h2>
            <div class="stats-grid">
                <div class="stat-card">
                    <h3>Gesamtspiele</h3>
                    <p class="stat-value" id="total-games">-</p>
                </div>
                <div class="stat-card">
                    <h3>Siege</h3>
                    <p class="stat-value" id="total-wins">-</p>
                </div>
                <div class="stat-card">
                    <h3>Niederlagen</h3>
                    <p class="stat-value" id="total-losses">-</p>
                </div>
                <div class="stat-card">
                    <h3>Siegrate</h3>
                    <p class="stat-value" id="winrate">-</p>
                </div>
                <div class="stat-card">
                    <h3>Ø Runden</h3>
                    <p class="stat-value" id="avg-turns">-</p>
                </div>
                <div class="stat-card">
                    <h3>Ø XP pro Spiel</h3>
                    <p class="stat-value" id="avg-xp">-</p>
                </div>
            </div>
            
            <h2 class="stats-section-title">Mehrspieler (PvP)</h2>
            <div class="stats-grid">
                <div class="stat-card">
                    <h3>Gesamtspiele</h3>
                    <p class="stat-value" id="mp-total-games">-</p>
                </div>
                <div class="stat-card">
                    <h3>Siege</h3>
                    <p class="stat-value" id="mp-total-wins">-</p>
                </div>
                <div class="stat-card">
                    <h3>Niederlagen</h3>
                    <p class="stat-value" id="mp-total-losses">-</p>
                </div>
                <div class="stat-card">
                    <h3>Unentschieden</h3>
                    <p class="stat-value" id="mp-total-draws">-</p>
                </div>
                <div class="stat-card">
                    <h3>Siegrate</h3>
                    <p class="stat-value" id="mp-winrate">-</p>
                </div>
                <div class="stat-card">
                    <h3>Aktuelles Rating</h3>
                    <p class="stat-value" id="mp-rating">-</p>
                </div>
                <div class="stat-card">
                    <h3>Höchstes Rating</h3>
                    <p class="stat-value" id="mp-highest-rating">-</p>
                </div>
                <div class="stat-card">
                    <h3>Aktuelle Serie</h3>
                    <p class="stat-value" id="mp-win-streak">-</p>
                </div>
                <div class="stat-card">
                    <h3>Längste Serie</h3>
                    <p class="stat-value" id="mp-longest-streak">-</p>
                </div>
            </div>
            
            <div class="ai-level-stats">
                <h3>Siegrate nach KI-Level</h3>
                <div id="ai-level-stats-container">
                    <!-- Dynamically populated -->
                </div>
            </div>
            
            <div class="recent-games">
                <h3>Letzte Spiele</h3>
                <div id="recent-games-container">
                    <!-- Dynamically populated -->
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // Load statistics on page load
        document.addEventListener('DOMContentLoaded', () => {
            loadStatistics();
        });
        
        async function loadStatistics() {
            try {
                const response = await fetch('api/user.php?action=statistics');
                const data = await response.json();
                
                if (!data.success) {
                    alert('Fehler beim Laden der Statistiken: ' + (data.error || 'Unbekannter Fehler'));
                    return;
                }
                
                // Update overall stats
                const overall = data.overall;
                document.getElementById('total-games').textContent = overall.total_games || 0;
                document.getElementById('total-wins').textContent = overall.total_wins || 0;
                document.getElementById('total-losses').textContent = overall.total_losses || 0;
                document.getElementById('winrate').textContent = (overall.winrate || 0) + '%';
                document.getElementById('avg-turns').textContent = overall.avg_turns || '-';
                document.getElementById('avg-xp').textContent = overall.avg_xp || '-';
                
                // Update multiplayer stats
                const mp = data.multiplayer;
                document.getElementById('mp-total-games').textContent = mp.games_played || 0;
                document.getElementById('mp-total-wins').textContent = mp.games_won || 0;
                document.getElementById('mp-total-losses').textContent = mp.games_lost || 0;
                document.getElementById('mp-total-draws').textContent = mp.games_drawn || 0;
                document.getElementById('mp-winrate').textContent = (mp.winrate || 0) + '%';
                document.getElementById('mp-rating').textContent = mp.rating || 1000;
                document.getElementById('mp-highest-rating').textContent = mp.highest_rating || 1000;
                document.getElementById('mp-win-streak').textContent = mp.win_streak || 0;
                document.getElementById('mp-longest-streak').textContent = mp.longest_win_streak || 0;
                
                // Update AI level stats
                const aiLevelContainer = document.getElementById('ai-level-stats-container');
                aiLevelContainer.innerHTML = '';
                
                if (data.by_ai_level && data.by_ai_level.length > 0) {
                    data.by_ai_level.forEach(level => {
                        const item = document.createElement('div');
                        item.className = 'ai-level-item';
                        item.innerHTML = `
                            <span class="ai-level-name">KI Level ${level.ai_level}</span>
                            <span class="ai-level-stats-values">
                                ${level.wins}/${level.games} Siege (${level.winrate}%)
                            </span>
                        `;
                        aiLevelContainer.appendChild(item);
                    });
                } else {
                    aiLevelContainer.innerHTML = '<p style="color: #ccc;">Noch keine Spiele gespielt</p>';
                }
                
                // Update recent games
                const recentGamesContainer = document.getElementById('recent-games-container');
                recentGamesContainer.innerHTML = '';
                
                if (data.recent_games && data.recent_games.length > 0) {
                    data.recent_games.forEach(game => {
                        const item = document.createElement('div');
                        item.className = 'game-item';
                        
                        const date = new Date(game.played_at);
                        const dateStr = date.toLocaleDateString('de-DE') + ' ' + date.toLocaleTimeString('de-DE');
                        
                        item.innerHTML = `
                            <span class="game-result ${game.result}">${game.result === 'win' ? 'SIEG' : 'NIEDERLAGE'}</span>
                            <span class="game-details">
                                KI Level ${game.ai_level} | ${game.turns_played || '-'} Runden | +${game.xp_gained} XP
                            </span>
                            <span class="game-details">${dateStr}</span>
                        `;
                        recentGamesContainer.appendChild(item);
                    });
                } else {
                    recentGamesContainer.innerHTML = '<p style="color: #ccc;">Noch keine Spiele gespielt</p>';
                }
            } catch (error) {
                console.error('Fehler beim Laden der Statistiken:', error);
                alert('Fehler beim Laden der Statistiken');
            }
        }
    </script>
</body>
</html>
